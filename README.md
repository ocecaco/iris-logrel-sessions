# iris-logrel-sessions (WIP)
This repository contains a Coq formalization of a logical relations proof of type safety for a programming language with session types. The programming language, HeapLang, is an ML-like language with support for message-passing concurrency based on channels between threads. It also supports shared-memory concurrency using heap references and atomic instructions. HeapLang is defined in the [Iris](https://gitlab.mpi-sws.org/iris/iris) repository and the message-passing functions are implemented in [Actris](https://gitlab.mpi-sws.org/jihgfee/actris/).

This repository defines a _session type system_ for HeapLang, and proves that it guarantees type safety. That is, any program which passes the type checker will not do things like trying to add an integer and string or reading from uninitialized memory. Session types guarantee that communication along channels proceeds as expected: for instance, it guarantees that a process will not be sent an integer when it is expecting a boolean. The type system also includes affine types, which can be used to encode ownership of resources. This is useful for reasoning about whether channels are used properly. For instance, it can guarantee that channels are not used after they are closed: when closing a channel, one has to give up ownership of it.

Type systems are often too restrictive in the sense that there are some programs which are intuitively well-typed, but which are rejected by the type checker, since it cannot "see" that the program is well-typed. Logical relations proofs of type safety allow you to formally prove that such code is type-safe. This technique is especially useful for languages like Rust, where one can use "unsafe" blocks to write code that would ordinarily be rejected by the type checker. Such proofs work by defining when a program has a certain type in terms of its _behavior_, instead of its syntactic structure. For example, an expression is defined to be of type `int` if it always evaluates to an integer. This leads to a less restrictive notion of type safety than that employed by type checkers. It allows you to have most parts of your program type checked by the type checker, with the exception of some parts, which can be manually verified by reasoning about program behavior.

The proof itself is defined using Iris, which is a concurrent separation logic implemented in Coq. The Iris logic provides features which make it very convenient for reasoning about programs which make use of heap pointers and fine-grained concurrency. Using Iris considerably simplifies the logical relations proofs compared to using an "ordinary" logic.
